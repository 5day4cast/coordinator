# Coordinator Helm Chart Values
# DLC competition platform coordinator service

replicaCount: 1

image:
  repository: ghcr.io/5day4cast/coordinator
  tag: "" # Defaults to appVersion
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: ""
  automount: true

service:
  type: ClusterIP
  port: 9990

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts: []
  tls: []

resources:
  requests:
    memory: 256Mi
    cpu: 100m
  limits:
    memory: 512Mi

podSecurityContext: {}
securityContext: {}

livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

persistence:
  enabled: true
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 5Gi
  mountPath: /data

litestream:
  enabled: false
  image:
    repository: litestream/litestream
    tag: "0.3.13"
  s3Bucket: ""
  s3Path: "coordinator.db"
  s3Region: "us-east-1"
  s3Endpoint: ""
  s3ForcePathStyle: false
  syncInterval: "10s"
  retention: "168h"
  snapshotInterval: "1h"

# Coordinator configuration matching config.rs
config:
  # Log level: trace, debug, info, warn, error
  logLevel: info

  # API settings
  api:
    domain: "0.0.0.0"
    port: "9990"
    origins:
      - "http://localhost:9990"

  # UI settings
  ui:
    privateUrl: "http://127.0.0.1:9990"
    remoteUrl: "http://127.0.0.1:9990"
    uiDir: "/app/public_ui"
    adminUiDir: "/app/admin_ui"

  # Coordinator settings
  coordinator:
    name: "coordinator"
    relativeLockTimeBlockDelta: 144
    requiredConfirmations: 1
    syncIntervalSecs: 15

  # Database settings
  database:
    dataFolder: "/data"
    readMaxConnections: 12
    readMinConnections: 2
    writeMaxConnections: 5
    writeMinConnections: 1
    idleTimeoutSecs: 600
    acquireTimeoutSecs: 15
    sqlite:
      mode: "ReadWriteCreate"
      cache: "Shared"
      busyTimeoutMs: 5000
      journalMode: "WAL"
      synchronous: "NORMAL"
      cacheSize: 1000000
      foreignKeys: true
      walAutocheckpoint: 1000
      tempStore: "Memory"
      mmapSize: 268435456
      pageSize: 4096

# Bitcoin settings
bitcoin:
  network: "regtest" # regtest, testnet, signet, mainnet
  esploraUrl: "http://localhost:9102"
  refreshBlocksSecs: 15

# Lightning settings
lightning:
  baseUrl: "https://localhost:8080"
  invoiceWatchIntervalSecs: 5
  payoutWatchIntervalSecs: 5
  # TLS cert path (optional, for self-signed certs)
  tlsCertPath: ""

# Oracle settings
oracle:
  url: "http://noaa-oracle.oracle.svc.cluster.local:9100"

# Keymeld settings
keymeld:
  enabled: false
  gatewayUrl: "http://keymeld.keymeld.svc.cluster.local:8080"
  keygenTimeoutSecs: 3600
  signingTimeoutSecs: 300
  maxPollingAttempts: 60
  initialPollingDelayMs: 500
  maxPollingDelayMs: 5000
  pollingBackoffMultiplier: 1.5

# Secrets configuration
# These reference Kubernetes secrets that should be created separately
secrets:
  # Private key for coordinator (nostr + bitcoin)
  privateKey:
    # If true, creates a secret from value below (for testing only)
    create: false
    # Name of existing secret
    existingSecret: "coordinator-private-key"
    key: "private-key.pem"
  # LND macaroon
  lndMacaroon:
    existingSecret: ""
    key: "admin.macaroon"
  # LND TLS cert
  lndTlsCert:
    existingSecret: ""
    key: "tls.cert"

# Additional environment variables
env: {}

# Environment variables from secrets/configmaps
envFrom: []

nodeSelector: {}
tolerations: []
affinity: {}

podAnnotations: {}
podLabels: {}

metrics:
  enabled: false
  path: /metrics
  interval: 30s

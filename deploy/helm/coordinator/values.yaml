# Coordinator Helm Chart Values
replicaCount: 1

image:
  repository: coordinator
  tag: latest
  pullPolicy: IfNotPresent

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts: []
  tls: []

resources:
  requests:
    memory: 128Mi
    cpu: 50m
  limits:
    memory: 256Mi

persistence:
  enabled: true
  size: 1Gi
  mountPath: /data

litestream:
  enabled: false
  image:
    repository: litestream/litestream
    tag: "0.3.13"
  s3Bucket: ""
  s3Region: "us-west-2"
  s3Endpoint: ""
  s3ForcePathStyle: false
  syncInterval: "10s"
  retention: "168h"
  snapshotInterval: "1h"
  retentionCheckInterval: "1h"
  # Encryption key for Litestream backups (age key format)
  # Can be set directly or via encryptionKeySecret to reference a K8s secret
  encryptionKey: ""
  encryptionKeySecret:
    enabled: false
    name: ""
    key: "encryption-key"
  # Use IAM role for S3 access (recommended for EC2/EKS)
  useIAMRole: false
  databases:
    - name: bitcoin
      path: /data/bitcoin.db
      s3Path: bitcoin.db
    - name: competitions
      path: /data/competitions.db
      s3Path: competitions.db
    - name: users
      path: /data/users.db
      s3Path: users.db

keymeld:
  url: "http://keymeld.keymeld.svc.cluster.local:8080"
  enabled: true
  gatewayUrl: "http://keymeld.keymeld.svc.cluster.local:8080"
  keygenTimeoutSecs: 30
  signingTimeoutSecs: 30
  maxPollingAttempts: 100
  initialPollingDelayMs: 100
  maxPollingDelayMs: 5000
  pollingBackoffMultiplier: 1.5

lnd:
  host: "lnd1"
  rpcPort: 10009
  macaroonPath: /lnd/admin.macaroon
  tlsCertPath: /lnd/tls.cert
  initContainer:
    enabled: false
    image: busybox:1.36
    sourcePvc: lnd1-data

bitcoin:
  rpcHost: "bitcoind"
  rpcPort: 18443
  rpcUser: "bitcoin"
  rpcPassword: "bitcoinpass"
  network: regtest
  esploraUrl: "http://esplora.bitcoin.svc.cluster.local:3000"
  refreshBlocksSecs: 10

lightning:
  baseUrl: "https://lnd1.bitcoin.svc.cluster.local:8080"
  tlsCertPath: "/etc/coordinator/secrets/tls.cert"
  invoiceWatchIntervalSecs: 5
  payoutWatchIntervalSecs: 10

oracle:
  url: "http://noaa-oracle.oracle.svc.cluster.local:8080"

config:
  logLevel: info
  dbPath: /data/coordinator.db
  database:
    dataFolder: /data
    readMaxConnections: 5
    readMinConnections: 1
    writeMaxConnections: 1
    writeMinConnections: 1
    idleTimeoutSecs: 300
    acquireTimeoutSecs: 30
    sqlite:
      mode: rwc
      cache: shared
      busyTimeoutMs: 5000
      journalMode: WAL
      synchronous: NORMAL
      cacheSize: -2000
      foreignKeys: true
      walAutocheckpoint: 1000
      tempStore: MEMORY
      mmapSize: 268435456
      pageSize: 4096
  api:
    domain: "0.0.0.0"
    port: "8080"
    origins:
      - "*"
  ui:
    privateUrl: "http://localhost:8080"
    remoteUrl: "http://localhost:8080"
    uiDir: "/app/ui"
  coordinator:
    name: "local-coordinator"
    relativeLockTimeBlockDelta: 144
    requiredConfirmations: 1
    syncIntervalSecs: 60

secrets:
  # Support for external secrets (managed outside Helm)
  privateKey:
    create: false
    value: ""
  lnd:
    create: false
    external: false
    secretName: "lnd-credentials"
    macaroon: ""
    tlsCert: ""

devMode:
  enabled: false
  hostPath: /mnt/coordinator/coordinator
  baseImage: debian:bookworm-slim

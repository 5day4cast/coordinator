# E2E Test Configuration
# This config enables mock services for fast, deterministic Playwright testing
# No external dependencies required (no LND, no Oracle server, no Bitcoin node)

[db_settings]
data_folder = "./data/e2e"
read_max_connections = 5
read_min_connections = 1
write_max_connections = 3
write_min_connections = 1
idle_timeout_secs = 300
acquire_timeout_secs = 10

[db_settings.sqlite_config]
mode = "ReadWriteCreate"
cache = "Shared"
busy_timeout_ms = 5000
journal_mode = "WAL"
synchronous = "NORMAL"
cache_size = 100000
foreign_keys = true
wal_autocheckpoint = 1000
temp_store = "Memory"

[api_settings]
domain = "127.0.0.1"
port = "9990"
origins = ["http://localhost:9990", "http://127.0.0.1:9990"]

[ui_settings]
private_url = "http://127.0.0.1:9990"
remote_url = "http://127.0.0.1:9990"
ui_dir = "./crates/public_ui"

[coordinator_settings]
oracle_url = "mock://oracle"
private_key_file = "./creds/coordinator_private_key.pem"
relative_locktime_block_delta = 6  # Shorter for testing
required_confirmations = 1
sync_interval_secs = 5  # Faster for testing
name = "e2e-coordinator"
escrow_enabled = false
mock_oracle = true  # Use MockOracle instead of real Oracle server

[bitcoin_settings]
network = "regtest"
esplora_url = "http://localhost:9102"
seed_path = "./creds/coordinator_private_key.pem"
storage_file = "./data/e2e/bitcoin.db"
refresh_blocks_secs = 30
mock_enabled = true  # Use MockBitcoinClient - no real Bitcoin infrastructure needed

[ln_settings]
base_url = "mock://lnd"
macaroon_file_path = "./creds/admin.macaroon"
invoice_watch_interval = 2
payout_watch_interval = 2
mock_enabled = true  # Use MockLnClient instead of real LND
mock_auto_accept_secs = 2  # Auto-accept invoices after 2 seconds

[keymeld_settings]
gateway_url = "http://localhost:8090"
enabled = false  # Disable keymeld for E2E tests - use local signing
keygen_timeout_secs = 60
signing_timeout_secs = 30
max_polling_attempts = 10
initial_polling_delay_ms = 100
max_polling_delay_ms = 1000
polling_backoff_multiplier = 1.5
